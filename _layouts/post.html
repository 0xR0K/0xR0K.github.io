<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title }} | LifeOnline</title>
  <link rel="stylesheet" href="{{ '/assets/style.css' | relative_url }}">
</head>
<body class="post-layout">

  <header>
    <div class="branding-container">
      <a href="{{ '/' | relative_url }}" class="site-logo">
        <img src="{{ '/assets/images/Logo.png' | relative_url }}" alt="0xR0K Logo">
      </a>
      <div class="site-identity">
        <h1><a href="{{ '/' | relative_url }}">LIFEONLINE</a></h1>
        <p>Toda una vida Conectado</p>
      </div>
    </div>
    <nav>
      <ul>
        <li><a href="{{ '/articulos/' | relative_url }}">Art√≠culos</a></li>
      </ul>
    </nav>
  </header>

  <main class="article-container">
    
    <header class="article-header">
      <h1 class="article-title">{{ page.title }}</h1>
      <div class="title-separator"></div>
    </header>

    <div class="article-content" id="markdown-content">
      {{ content }}
    </div>

  </main>

  <footer>
    <p>&copy; 2025 LifeOnline | 0xR0K</p>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      
      const contentDiv = document.getElementById("markdown-content");
      const postSlug = "{{ page.slug }}"; 
      const baseUrl = "{{ site.baseurl }}";

      const obsidianImageRegex = /!\[\[(.*?)\]\]/g;

      contentDiv.innerHTML = contentDiv.innerHTML.replace(obsidianImageRegex, function(match, fileName) {
        const cleanFileName = encodeURIComponent(fileName.trim());
        const finalPath = `${baseUrl}/assets/images/${postSlug}/${cleanFileName}`;
        return `<img src="${finalPath}" alt="${fileName}" class="obsidian-img-auto">`;
      });


      const blockquotes = document.querySelectorAll("blockquote");
      
      blockquotes.forEach(quote => {
        const firstP = quote.querySelector("p");
        if (!firstP) return;
        
        const text = firstP.textContent;
        const match = text.match(/^\[!(.*?)\]/);
        
        if (match) {
          const type = match[1].toLowerCase();
          
          let customTitle = text.replace(match[0], "").trim();
          
          firstP.innerHTML = firstP.innerHTML.replace(match[0], "").trim();

          if(firstP.innerText.trim() === "") {
             firstP.style.display = "none";
          }

          quote.classList.add("callout");
          quote.classList.add(`callout-${type}`);
          
          let icon = "üìù"; 
          let defaultTitle = type.toUpperCase();

          if (type.includes('warn') || type.includes('alert')) { icon = "‚ö†Ô∏è"; defaultTitle = "ALERTA"; }
          if (type.includes('danger') || type.includes('error')) { icon = "üî•"; defaultTitle = "PELIGRO"; }
          if (type.includes('success') || type.includes('check')) { icon = "‚úÖ"; defaultTitle = "√âXITO"; }
          if (type.includes('info') || type.includes('note')) { icon = "‚ÑπÔ∏è"; defaultTitle = "NOTA"; }
          if (type.includes('tip')) { icon = "üí°"; defaultTitle = "CONSEJO"; }

          if (!customTitle) customTitle = defaultTitle;

          const headerDiv = document.createElement("div");
          headerDiv.className = "callout-header";
          headerDiv.innerHTML = `<span class="callout-icon">${icon}</span> <strong class="callout-title-text">${customTitle}</strong>`;
          
          const contentWrapper = document.createElement("div");
          contentWrapper.className = "callout-content";

          while (quote.firstChild) {
            contentWrapper.appendChild(quote.firstChild);
          }


          quote.appendChild(headerDiv);
          quote.appendChild(contentWrapper);
        }
      });
    });
  </script>

</body>
</html>
